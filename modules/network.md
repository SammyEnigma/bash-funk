# Bash-Funk "network" module

[//]: # (THIS FILE IS GENERATED BY BASH-FUNK GENERATOR)

The following commands are available when this module is loaded:

1. [-block-port](#-block-port)
1. [-get-ips](#-get-ips)
1. [-is-port-open](#-is-port-open)
1. [-test-network](#-test-network)
1. [License](#license)


## <a name="-block-port"></a>-block-port

```
Usage: -block-port [OPTION]... [BIND_ADDRESS] PORT

Binds to the given port and thus block other programs from binding to it.

Parameters:
  BIND_ADDRESS 
      The local bind address. E.g. 127.0.0.1.
  PORT (required)
      Number of the port to occupy.

Options:
    --help 
        Prints this help.
    --selftest 
        Performs a self-test.

Examples:
$ -block-port 70000
Error: Value '70000' for parameter PORT is too high. Must be <= 65535.
```

*Implementation:*
```bash
if [[ $_BIND_ADDRESS ]]; then
    local localAddr=$_BIND_ADDRESS
    local localPort=$_PORT
else
    local localAddr=0.0.0.0
    local localPort=$_PORT
fi

echo "Binding to $localAddr:$localPort..."

perl << EOF
    use IO::Socket;
    \$server = IO::Socket::INET->new(
        LocalAddr => '$localAddr',
        LocalPort => $localPort,
        Type => SOCK_STREAM,
        ReuseAddr => 1,
        Listen => 10
    ) or die "Couldn't bind to $localAddr:$localPort: \$@\n";
    while (\$client = \$server->accept()) { }
    close(\$server);
EOF
```


## <a name="-get-ips"></a>-get-ips

```
Usage: -get-ips [OPTION]...

Prints the IP v4 addresses of this host excluding 127.0.0.1.

Options:
    --help 
        Prints this help.
    --selftest 
        Performs a self-test.
```

*Implementation:*
```bash
ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'
```


## <a name="-is-port-open"></a>-is-port-open

```
Usage: -is-port-open [OPTION]... HOSTNAME PORT [CONNECT_TIMEOUT_IN_SECONDS]

Checks if a TCP connection can be established to the given port.

Parameters:
  HOSTNAME (required)
      Target hostname.
  PORT (required)
      Target TCP port.
  CONNECT_TIMEOUT_IN_SECONDS 
      Number of seconds to try to connect to the given port. Default is 5 seconds.

Options:
    --help 
        Prints this help.
    --selftest 
        Performs a self-test.
-v, --verbose 
        Prints additional information during command execution.

Examples:
$ -is-port-open localhost 12345 1

$ -is-port-open -v localhost 12345 1
localhost:12345 is not reachable.
$ -is-port-open localhost 70000
Error: Value '70000' for parameter PORT is too high. Must be <= 65535.
```

*Implementation:*
```bash
if hash nc &> /dev/null; then
    if nc -vz -w ${_CONNECT_TIMEOUT_IN_SECONDS:-5} $_HOSTNAME $_PORT; then
        portStatus=open
    else
        portStatus=
    fi
else
    local portStatus=$(perl << EOF
        use IO::Socket;
        my \$socket=IO::Socket::INET->new(
            PeerAddr => "$_HOSTNAME",
            PeerPort => $_PORT,
            Timeout => ${_CONNECT_TIMEOUT_IN_SECONDS:-5}
        );

        if (defined \$socket) {
            sleep 1;
            (defined \$socket->connected ? print("open") : q{});
        }
EOF
    )
fi

if [[ $portStatus == "open" ]]; then
    [[ $_verbose ]] && echo "$_HOSTNAME:$_PORT is open." || true
    return 0
else
    [[ $_verbose ]] && echo "$_HOSTNAME:$_PORT is not reachable." || true
    return 1
fi
```


## <a name="-test-network"></a>-test-network

```
Usage: -test-network [OPTION]...

Performs a selftest of all functions of this module by executing each function with option '--selftest'.

Options:
    --help 
        Prints this help.
    --selftest 
        Performs a self-test.
```

*Implementation:*
```bash
${BASH_FUNK_PREFIX:-}-block-port --selftest && echo || return 1
${BASH_FUNK_PREFIX:-}-get-ips --selftest && echo || return 1
${BASH_FUNK_PREFIX:-}-is-port-open --selftest && echo || return 1
```


## <a name="license"></a>License

Copyright (c) 2015-2017 Vegard IT GmbH, http://vegardit.com

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

